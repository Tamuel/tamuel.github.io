---
title: "네트워크 정리"
date: 2019-03-01 18:16:30 -0400
categories: Networw
tags: Network
---
# 네트워크 정리

**Behrouz A. Forouzan "*TCP/IP Protocol Suite*" 참고**

## Introduction

### Brief History
네트워크란 커뮤니케이션 기기들의 그룹이라 볼 수 있고 Internet은 서로 커뮤니케이션 가능한 Network 들이라 볼 수 있음
![img01](/assets/images/markdown-img-paste-20190301183702843.png)

### Protocols and Standards
* Protocol(프로토콜) = Rule(규칙)
* Standards(표준) = 룰을 따르는 것


## The OSI Model and the TCP/IP Protocol Suite

### Protocol Layers
프로토콜은 두 개의 객체가 커뮤니케이션하는데 필요함 (서로 규칙이 맞아야 말이 통함), 만약 커뮤니케이션 방법이 어렵다면 각자 프로토콜을 가진 여러 레이어로 나눌 수 있음

* 커뮤니케이션이 간단할 경우
  ![img02](/assets/images/markdown-img-paste-20190301184122973.png)

* 어려울 경우
  ![img03](/assets/images/markdown-img-paste-20190301184158381.png)

### OSI Model
OSI(Open Systems Interconnection)이란 ISO(International Standards Organization)이 1970년대에 만든 네트워크 커뮤니케이션 표준

* OSI model을 이용한 데이터 교환
  * In-Capsulation : 데이터에 헤더를 붙여 패킷으로 만든 후 하위 레이어로 보냄
  * De-Capsulation : 데이터에서 헤더를 때면서 상위 레이어로 보냄
    ![img04](/assets/images/markdown-img-paste-20190301184825208.png)

* 물리 레이어(Physical Layer)는 각각의 bit를 하나의 노드에서 다른 노드로 옮겨줘야함

#### OSI Layers 요약

|#|이름|주소|데이터단위|하는 일|
|-------|-----------|--|--|--|
|7|**Application**|Application Specific||네트워크 자원 접근 가능하게|
|6|Presentation|||데이터 해석, 암호화, 압축|
|5|Session||Message|Session 열기, 관리, 닫기|
|4|**Transport**|PORT (TCP/UDP) 2byte|Segment(TCP), User Datagram(UDP)|신뢰성 있는 **Process-to-Process** 메시지 전송과 에러 복구|
|3|**Network**|IP (Logical) 4byte(v4)/16byte(v6)|Datagram(패킷)|인터넷 작동을 위해 **패킷**을 목적지로 보냄|
|2|**Data Link**|Mac (Physical) 6byte|Frame|Hop-to-Hop 전송을 위해 비트들을 **프레임**으로 관리|
|1|**Physical**||Bit|**비트**를 매체(Medium)를 통해 전송, 기계적, 전자적 능력 필요|

### TCP/IP Protocol Suite
OSI 모델 보다 먼저 만들어짐

|Layer|Name|
|-------|-----------|
|Layer 5|Application|
|Layer 4|Transport|
|Layer 3|Network|
|Layer 2|Data Link|
|Layer 1|Physical|

#### Physical Address
6바이트 16진수 주소를 가짐
* eg) 07:01:02:01:2C:4B
* 라우터를 지나면서(Hop-to-Hop) Mac 주소는 바뀌지만 Logical 주소와 Port 주소는 바뀌지 않음
  ![img05](/assets/images/markdown-img-paste-20190301191253987.png)


## Underlying Technology (Layer 1, 2)
레이어 1, 2는 Access가 목적이고 3, 4, 5는 네트워킹이 목적임

### LAN (wired Local Area Networks)
제한된 범위 (가정, 회사) 내에서 사용하는 네트워크, 독립된(Isolated) 네트워크 구성 가능, 최근 LAN은 WAN(Wide Area Network)나 인터넷에 연결됨, 주로 Ethernet(이더넷) 사용
* 이더넷을 주로 사용하나, Token ring, Token bus, FDDI, ATM LAN 등도 존재

![img06](/assets/images/markdown-img-paste-20190301192155477.png)
![](/assets/images/markdown-img-paste-2019030121160800.png)
![](/assets/images/markdown-img-paste-20190301211637562.png)

* 이더넷 주소는 6bytes 사용
  ![](/assets/images/markdown-img-paste-20190301211743623.png)

* 첫 바이트 마지막 자리가 0이면 유니캐스트 (1:1 통신), 1이면 멀티캐스트 (1:N 통신)
  ![](/assets/images/markdown-img-paste-20190301211818904.png)

* 모든 비트가 1 이면 브로드캐스트(Broadcast, 1:ALL)
  * FF:FF:FF:FF:FF:FF


### Wireless Lans
IEEE 802.11 무선랜 (무선 이더넷), 블루투스
![](/assets/images/markdown-img-paste-20190301212635452.png)

### Point-to-Point Wans
Point-to-Point Wide Area Network. WAN은 떨어져 있는 두 기기를 공공 네트워크 선(모뎀 등)으로 이어줌
* DSL, Cable 모뎀, T-line, SONET 등 있음

### Switched Wans
인터넷의 백본 네트워크는 스위치 WAN임. 넓은 영역을 커버하고 몇 포인트에 유저가 접근하는걸 제공해줌. 포트가 여러 개라 여러 입력과 출력을 낼 수 있음

### Connecting Devices
LAN과 WAN들은 보통 떨어져있지 않고 같이 연결되거나 인터넷에 연결되어 사용됨.
* Repeaters (HUB) : 자신에게 온 모든 데이터를 전달하고 (필터링 기능 없음) 증폭기 역할도 함
* Bridges (Two-layer switches) : 테이블이 있어 필터링 가능, 프레임의 물리 주소를 바꾸지 않음
  * Multi Port Bridge = Switch
* Routers (Three-layer switches) : 세개의 레이어(Network, Data Link, Physical)를 가진 기기
  * 라우터는 패킷의 물리 주소(MAC)를 바꿈
* Repeater와 Bridge는 LAN의 세그멘트를 연결해주고, 라우터는 LAN이나 WAN을 서로 연결해줌 (Internetwork)
  ![](/assets/images/markdown-img-paste-20190301213427609.png)


## Introduction to Network Layer

### Introduction
인터넷을 블랙박스라 생각하고, 여기서는 컴퓨터 두 대가 서로의 어플리케이션 레이어끼리의 메시지를 준다고 생각
![](/assets/images/markdown-img-paste-20190301214233753.png)

* 인터넷은 LAN들과 WAN들의 연결이라 생각하면 됨
  ![](/assets/images/markdown-img-paste-20190301214513291.png)


### Switching
만약 메시지가 길을 따라 가다가 연결기기(Connecting device)를 만나면 그 기기가 어디 출력 포트로 보낼지 선택을 해야함. 연결기기가 스위치로서 작동한다고 보면됨

#### Circuit Switching
전체 메시지가 패킷으로 나누어지지 않고 출발지(Source)에서 목적지(Destination) 까지 전송됨
* 초기 전화 시스템 생각하면됨

#### Packet Switching
메시지가 먼저 관리가 용이한 패킷들로 나뉜 다음 목적지로 전송됨. 목적지에 도착하면 다시 합쳐짐


### Packet Switching
네트워크 레이어(레이어3)은 패킷 스위치 네트워크로 디자인됨. 패킷들을 나눈다고 했는데, 이 패킷들을 **"데이터그램(Datagram)"** 이라 부름. 데이터그램은 목적지에 도착하면 다시 재조립됨. 과거에는 보통 Packet-switched network layer의 경우 Connectionless 서비스로 개발되었지만 최근에는 Conneection-oriented 서비스인 경우가 종종 있음

#### Connectionless packet-switched network
  * UDP의 경우
  * 순서가 보존되지 않음 (따로 관리 안함)
  * 속도가 빠름
    ![](/assets/images/markdown-img-paste-20190301215658466.png)

  * Forwarding process in a Connectionless Network
    * Forwarding (포워딩) : 다음 HOP으로 전송하는 것
    * Routing (라우팅) : Ent-to-End 전송
    * 라우터에서 테이블 룩업 후 도착지 주소(Destination address)에 해당하는 인터페이스(포트)를 통해 전송
      ![](/assets/images/markdown-img-paste-20190301215836908.png)

  * Delay in a connectionless network
    * Delay variation(Jitter)이 있어 버퍼링을 함 (편차 상쇄)
      ![](/assets/images/markdown-img-paste-2019030122010750.png)

#### Connection-oriented packet-switched network
  * TCP의 경우
  * 순서가 보존됨 (따로 순서와 전송 등을 관리하기 때문)
  * 속도가 UDP 보단 느림
    ![](/assets/images/markdown-img-paste-20190301220257969.png)

  * 포워딩이 도착지 주소가 아닌 패킷의 "라벨"에 따라 이루어짐
    ![](/assets/images/markdown-img-paste-2019030122052996.png)

  * Sending request packet in a virtual-circuit network
    * 마치 전선(길)이 있는 것 처럼 데이터 전송
    * Signaling으로 미리 가상의 길을 만든 후 전
      ![](/assets/images/markdown-img-paste-20190301220646146.png)

  * Delay in a connection-oriented network
    * Setup과 Teardown시 시간이 걸리긴 하지만 전송중 딜레이는 더 적음 (테이블 그때마다 찾아보지 않아도되기 때문)
      ![](/assets/images/markdown-img-paste-20190301221518441.png)

### Network Layer Services

#### Services provided at the source computer
  ![](/assets/images/markdown-img-paste-20190301221846187.png)

#### Processing at each router
  ![](/assets/images/markdown-img-paste-20190301222047571.png)

#### Processing at the destination computer
  ![](/assets/images/markdown-img-paste-20190301222151906.png)


## IPv4 Addresses
IP(Network) 레이어에서 인터넷에 연결된 각 기기를 구분하기 위해 부르는 주소를 **IP주소** 라 한다.
IPv4 주소의 경우 32bit (4byte) 주소를 사용. 인터넷의 Host나 Router를 고유하게 구분하기 위해 사용.
IP 주소는 인터페이스의 주소임

* 32bit 이므로 $2^{32}$개의 주소를 가질 수 있음
* 10진수 사용 eg) 255.124.0.125.

### Classful Addressing
처음 IPv4를 만들 때는 클래스라는 컨셉을 썻음. 1990년대 중반부터 Classless 사용.

![](/assets/images/markdown-img-paste-2019030122333730.png)

* NetID, HostID
  * Netid는 할당해주고 Hostid는 할당 받은 기관이 마음대로 사용
  * A, B 클래스는 너무 많이 낭비됨
  * C 클래스는 너무 적음
  * D 클래스는 통신 할 때만 사용
  * IPv4는 거의 다 할당 됨
    ![](/assets/images/markdown-img-paste-20190301223502121.png)

* 샘플 인터넷
  ![](/assets/images/markdown-img-paste-20190301223819433.png)

* Network address (NetID)는 네트워크의 구분자(Identifier)
  * 라우팅 테이블에 모든 주소가 있는 것이 아니라 NetID들이 있음
    ![](/assets/images/markdown-img-paste-2019030122394633.png)

* Subnetwork mask
  * NetID, SubnetID, HostID로도 구분 가능 (서브넷은 적절히 크기 정함)
    ![](/assets/images/markdown-img-paste-2019030214495810.png)

* Supernet mask도 존재

### Classless Addressing
서브넷, 슈퍼넷을 통해서도 주소 고갈문제를 해결 할 수는 없음. IPv6로 많은 주소 제공도 있지만, 그 전에 같은 주소 공간을 쓰지만 분포를 다르게 해서 각 기관이 공평하게 쓰는 방법이 있고 이를 IPv4를 이용한 **Classless addressing** 방법이라함

* Classless Addressing에서는 접두사(Prefix)는 네트워크를 정의하고, 집미사(Suffix)는 호스트를 정의
  * 접두사는 1에서 32비트까지 쓰임
    ![](/assets/images/markdown-img-paste-20190302145651802.png)

* Classless는 어디까지가 NetworkID인지 따로 알려줘야함
  * 아래에서 n이 접두사의 길이를 뜻함
    * byte.byte.byte.byte/n

* Subnet 잘못 지정시 다른 주소의 NetworkID와 겹침

### Special Addresses
* 0.0.0.0 : 주소를 모를 때 (DHCP에서 처음에 주소를 얻어올 때)
* 255.255.255.255 : Broadcast 주소 (모든 네트워크)
  * 라우터는 Broadcast가 목적지인 패킷을 막음 (해당 라우터 이내에서만 가도록)
* 127.x.y.z : 컴퓨터 내부 프로세스 간 통신 (밖으로 나가지 않음)
* 개인용 네트워크 (공유기)

  |Block|Number of addresses|
  |:----:|:----:|
  |10.0.0.0/8|16,777,216|
  |172.16.0.0./12|1,047,584|
  |192.168.0.0./16|65,536|
  |169.254.0.0./16|65,536|

* Directed Broadcast
  * 네트워크가 221.45.71.0/24 일 경우 라우터에서 221.45.71.255/24(HostID 비트가 모두 1)로 패킷을 보내면 해당 네트워크로 브로드캐스팅함

### NAT
NAT (Network Addres Translation), 공유기라고 생각하면됨 Public 주소 패킷을 받아 Translation Table을 보고 Private 주소로 변환해서 넘겨줌
![](/assets/images/markdown-img-paste-20190302161626536.png)
![](/assets/images/markdown-img-paste-2019030216171290.png)

## Delivery and Forwarding of IP Packets

### Delivery
네트워크 레이어는 패킷 전송을 담당해야함. 목적지까지 패킷을 전송하는 방법은 크게 **Direct** 와 **Indirect** 두 방법이 있음

#### Direct Delivery
한 네트워크 안에서 패킷 전송 (네트워크 내의 기기끼리 혹은 네트워크 담당 라우터에서 기기까지)
![](/assets/images/markdown-img-paste-20190302162450901.png)

#### Indirect Delivery
라우터를 거치면서 패킷 전송
![](/assets/images/markdown-img-paste-2019030216233979.png)


### Forwarding
라우터 내의 패킷을 패킷의 목적지로 보내는 것 (Deliver to the next Hop)
* Route를 모두 보거나 (Full route), 다음 Hop 만 봄, IP Router는 Next HOP 만 봄
  ![](/assets/images/markdown-img-paste-20190302162726729.png)

#### Network-specific routing
  * 네트워크 단위로 보기 때문에 좀 더 간소함
    ![](/assets/images/markdown-img-paste-20190302162903672.png)

#### Host-specific routing
  * DNS 같은 경우 예외로 Host specific 쓰기도 함
    ![](/assets/images/markdown-img-paste-20190302163027895.png)

#### Default routing
  * 테이블에 따로 명시되지 않은 Route는 Default로 감
  * 보통 PC는 Default 만 가지기도 함
    ![](/assets/images/markdown-img-paste-20190302163307324.png)

#### Classful Addressing에서 Routing
* Net
  ![](/assets/images/markdown-img-paste-2019030216344187.png)
* Subnet
  ![](/assets/images/markdown-img-paste-20190302163525278.png)
* 위에서 Interface Number는 라우터 슬롯의 맥주소임
* Classful Addressing에서는 3열로 테이블 표현 가능하지만 Classless일 경우 Prefix까지 합쳐 4열로 표현
  ![](/assets/images/markdown-img-paste-20190302163753157.png)

#### Longest mask matching
테이블에서 중복되는 주소가 있을 시 가장 길게 매칭되는 쪽으로 감
  ![](/assets/images/markdown-img-paste-20190302164531537.png)

* Hierarchical routing with ISPs
  * 계층적 구조를 가지고 라우팅 가능
* 목적지 주소로 라우팅
* 라벨을 기반으로 라우팅

### Structure of A Router (라우터 구조)
* Router Components
  ![](/assets/images/markdown-img-paste-20190302164944261.png)
* Input Port
  ![](/assets/images/markdown-img-paste-20190302165020261.png)
* Output Port
  ![](/assets/images/markdown-img-paste-20190302165043913.png)
* Banyan switch
  ![](/assets/images/markdown-img-paste-20190302165202806.png)
* Batcher-banyan switch
  ![](/assets/images/markdown-img-paste-20190302165225207.png)



## IPv4 (Internet Protocol Version 4)

### Introduction
Internet Protocol은 네트워크 레이어에서 TCP/IP 프로토콜이 사용하는 전송 매커니즘
![](/assets/images/markdown-img-paste-20190302165646358.png)

### Datagrams
네트워크 레이어의 패킷을 **Datagram** 이라고 함. "**헤더**"와 "**데이터**"로 이루어져 있음
* 헤더 : 20 ~ 60 바이트로 라우팅과 전송에 필요한 필수 정보를 가짐

#### IP Datagram 헤더 구조
![](/assets/images/markdown-img-paste-2019030217005508.png)
|이름|역할|
|----|----|
|VER|버전, IPv4일 경우 0100|
|HLEN|헤더 길이, 단위는 word(4byte), 최소 5이상 (20byte)이상 이어야 정상, 아니면 무시|
|Service type|Real Time, Reliable 등의 패킷 타입 명시 (요즘은 사용 안함), 앞의 6비트만 사용, XXXXX0는 인터넷, XXXX11은 로컬, XXXX01은 임시 혹은 실험용|
|Total length|헤더+데이터 총 길이, 단위는 byte|
|Identification|패킷 ID, Fragmentation 후에도 같은 패킷인지 인식 위해|
Fragmentation offset|바이트/8, 시작 지점으로 부터 얼마나 떨어져 있는지, 175의 경우 시작이 1400byte라는 말|
|Flags|3bit는 [0DM]으로 볼 수 있음, D는 Fragment하면 안됨, M은 Fragment가 더 있음을 의미, 001의 경우 뒤에 패킷이 더 있다는 의미|
|Time to live (TTL)|Hop Count라고도 하며 몇 HOP갈 것인지, 보통 255,128,64|
|Protocol|TCP(6), UDP(17) 기타 등등|
|Header checksum|헤더의 Corruption체크 (정보 손상이 있는지)|
|Source IP address|송신지 주소 (4byte)|
|Destination IP address|수신지 주소 (4byte)|
|Options+Padding|기타|

#### Encapsulation of a small datagram in an Ethernet frame
![](/assets/images/markdown-img-paste-20190302171300892.png)

#### Multiplexing
* ICMP (1) : Internet Control Message Protocol
* IGMP (2) : Internet Group Management Protocol (Multicast)
* TCP (6) : Transmission Control Protocol
* UDP (17) : User Datagram Protocol
* OSPF (89) : Open Shortest Path First Routing Protocol
![](/assets/images/markdown-img-paste-20190302171359627.png)

### Fragmentation
패킷을 나눔

#### MTU (Maximum Transfer Unit)
망에서 지원하는 최대 패킷 사이즈
* Datagram이 왔을 경우 MTU로 사이즈로 나눠서(Fragmentation) 전송
* 오직 data만 나눔 (헤더를 나눌수는 없음)

#### Fragmentation 예제
![](/assets/images/markdown-img-paste-20190302173136294.png)

### Options
헤더 20바이트는 앞의 기본 헤더이고 + 40바이트까지 옵션을 설정 가능. 네트워크 테스팅과 디버깅시 사용. 헤더에 꼭 필요하진 않음
* TLV 포맷
![](/assets/images/markdown-img-paste-20190302174804445.png)
![](/assets/images/markdown-img-paste-20190302174847884.png)

|Operation|설명|
|---|---|
|No operation|Padding 용 (4의 배수 byte로 끝나게)|
|End of option|옵션 끝 알림|
|Record route|루트 기억 (총 9개)|
|Strict source route|수신자가 루트를 정해주고, 갈 수 없다면 버림|
|Loose source route|수신자가 루트를 정해주고 웬만하면 따라가게함|
|Timestamp|보낸 시간|

### Checksum
TCP/IP 프로토콜에서 에러 검출 방법을 Checksum이라함. 전송 중 패킷 손상을 방지함. 수신자가 헤더에 대해서 계산을 해서 결과가 만족되면 패킷을 받아들임
* Checksum은 헤더만을 관리하고, Data는 하지 않음 (TCP가 관리)
![](/assets/images/markdown-img-paste-20190302175547556.png)
* 1의 보수 방법
![](/assets/images/markdown-img-paste-2019030217560283.png)

### IP Components
![](/assets/images/markdown-img-paste-20190302175900108.png)


## ARP (Address Resolution Protocol)
주소를 알아오는 프로토콜

### Address Mapping
논리적(Logical), 물리적(Physical) 주소들 끼리 맵핑이 필요함. 정적(Static) 맵핑과 동적(Dynamic) 맵핑 존재. IP 데이터그램에는 목적지의 논리적 주소만 존재함. 하지만 데이터그램은 물리적 네트워크를 통과하기 위해 Encapsulation을 통해 프레임으로 변환되어야 함. 그 말인즉 송신자가 수신자의 물리 주소를 알아야한다는 말. **ARP** 는 IP 프로토콜로 부터 논리 주소를 받고 해당 주소를 물리 주소와 맵핑한 다음 데이터 링크 레이어로 보냄
![](/assets/images/markdown-img-paste-20190302180504154.png)

#### ARP Operation
Subnet안에서 브로드캐스트로 ARP Request를 보내면 해당하는 기기에서 물리주소를 채워넣은 다음 다시 보낸 기기로 유니캐스트로 돌려보냄
![](/assets/images/markdown-img-paste-20190302180600914.png)
![](/assets/images/markdown-img-paste-20190302180608362.png)

#### ARP Packet
![](/assets/images/markdown-img-paste-20190302180753324.png)

#### ARP Packet Encapsulation
![](/assets/images/markdown-img-paste-20190302180852195.png)

#### 4가지 케이스
1. 같은 네트워크 상에서 한 호스트가 다른 호스트로 패킷 보낼 경우
  * 타겟 주소는 IP 데이터그램의 목적지 주소
2. 호스트가 다른 네트워크의 호스트로 패킷을 보낼 경우
  * 타겟 주소는 라우터의 IP 주소
3. 라우터가 다른 네트워크의 호스트로 패킷을 보낼 경우
  * 타겟 주소는 다른 라우터의 IP 주소
4. 라우터가 같은 네트워크의 호스트에게 패킷을 보낼 경우
  * 타겟 주소는 IP 데이터그램의 목적지 주소
